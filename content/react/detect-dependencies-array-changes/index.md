---
title: React는 의존성 배열의 변화를 어떻게 감지할까?
category: react
date: 2023-03-18
tags:
  - 의존성배열
  - useEffect
  - cleanup
---

# 들어가며

우리가 React로 개발을 하다보면 `useEffect`와 같은 Hooks를 사용할 때 **의존성 배열**을 넣어주는 경우가 많다. 의존성 배열에 넣어주는 값이 변화하면 콜백함수가 실행되는데, 이 의존성 배열의 변화를 어떻게 감지할까? 라는 궁금증이 생겼다. 이번 포스팅을 통해 의존성 배열이 어떻게 변화를 감지하는지 알아보자.

> **이 포스팅의 이해를 돕기 위해 다음 포스팅을 먼저 읽어보는 것을 추천한다.**
>
> [JavaScript: 원시 타입과 객체 타입](https://chamdom.blog/primitive-and-object/) <br/> [React는 useEffect를 어떻게 실행할까?](https://chamdom.blog/react-useEffect)

# 의존성 배열이란?

```js
useEffect(() => {
  // 콜백 함수
}, [dependency1, dependency2, ...]); // 의존성 배열
```

의존성 배열은 그 이름에서도 알 수 있듯이 **배열**이다. 이 배열은 `useEffect` 훅의 두 번째 매개변수로 전달되며, 배열에 포함된 요소는 `useEffect` 훅이 실행되는 것에 영향을 미치는 **'의존성'**이다.

의존성 배열 안에 있는 값이 변경될 때마다, useEffect 내부의 **콜백 함수**는 다시 호출된다. 즉, 이 값들의 변화에 따라 `useEffect`의 실행이 결정된다.

# 의존성 배열의 변화를 어떻게 감지할까?

자, 의존성 배열이 무엇인지 간단하게 알아봤으니 이제 의존성 배열의 변화를 어떻게 감지하는지 알아보자. 위에서 추천한 포스팅에서 다루는 내용이지만, 의존성 배열의 변화 감지는 React의 `render/commit phase`와 관련이 있다.

### render phase(렌더링 단계)

각 컴포넌트의 `useState`와 `useEffect` 등의 훅들이 호출되며, 이때 훅들의 상태와 순서 정보가 [메모리 셀(memory cells)](https://ko.legacy.reactjs.org/docs/hooks-faq.html#how-does-react-associate-hook-calls-with-components)에 저장된다. **의존성 배열이 있다면 이 배열의 현재 상태를 기록한다.**

### commit phase(커밋 단계)

DOM의 업데이트가 완료되면, React는 `useEffect` 훅들을 처리한다. 이때 **클린업 단계**와 **이펙트 실행 단계**로 나눌 수 있다.

**클린업 단계** <br/>
이전 렌더링에서 `useEffect`가 반환한 클린업 함수가 있다면, 이 함수를 실행하여 이전 이펙트를 정리한다. 이는 컴포넌트의 상태가 변경되거나 컴포넌트가 언마운트될 때 발생하는 사이드 이펙트를 방지하기 위한 단계다.

**이펙트 실행 단계** <br/>
이전 렌더링의 의존성 배열과 현재 렌더링의 의존성 배열을 비교하여, 의존성 배열에 변화가 있는지 감지한다. 변화가 있다면, `useEffect`에 전달된 콜백 함수를 실행한다. 이 콜백 함수는 새로운 사이드 이펙트를 수행하며, 이펙트가 끝났을 때 수행해야 할 클린업 작업을 위한 새 클린업 함수를 반환할 수 있다.

# 마치며

기존에 알고 있었던 자바스크립트의 특징으로 인해 참조 값(메모리 주소)로 비교하는 것은 이해하기 쉬웠지만, 의존성 배열을 어디에 저장하고 어떻게 비교하는지는 좀 더 공부가 필요한 부분이다. 이번 포스팅으로 알게된 것은 render, commit phase에서 의존성 배열을 비교한다는 것이다. 나중에 꼭 리액트 코드를 뜯어보면서 컴포넌트가 렌더링될 때, 상태를 어떻게 저장하고 처리하는지고 정리해야겠다.
